<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zapixan Dosing Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-bg-dark: rgba(30, 41, 59, 0.9);
            --border-dark: #334155;
            --text-dark: #e2e8f0;
            --text-muted: #94a3b8;
            --primary: #c00000;
            --primary-light: #e53e3e;
            --success: #22c55e;
            --success-light: #86efac;
            --warning: #f59e0b;
            --warning-light: #fde68a;
            --danger: #ef4444;
            --danger-light: #fecaca;
            --info: #60a5fa;
            --info-light: #dbeafe;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-dark);
            margin: 0;
            padding: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%231e293b" opacity="0.1"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="%23334155" stroke-width="0.5" opacity="0.2"/></svg>');
            background-size: 300px 300px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            display: grid;
            gap: 1.5rem;
            position: relative;
            z-index: 1;
            margin-top: 60px;
        }

        /* Sticky ISIO logo with animation */
        .sticky-logo {
            position: fixed;
            top: 15px;
            left: 15px;
            height: 50px;
            z-index: 1000;
            animation: pulse 2s infinite;
            background: white;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #c00000;
            width: 140px;
        }

        .sticky-logo img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .card {
            background-color: var(--card-bg-dark);
            border: 1px solid var(--border-dark);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease;
            backdrop-filter: blur(4px);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
        }

        header {
            text-align: center;
            position: relative;
            animation: slideDown 0.8s ease-out;
        }
        
        header h1 {
            color: var(--text-dark);
            font-size: 2rem;
            margin: 0.5rem 0;
            background: linear-gradient(90deg, #e53e3e, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        header p {
            text-align: center;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .lang-toggle-container {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            animation: fadeIn 1.2s ease-out;
        }

        .lang-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .lang-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-dark);
            transition: .4s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.25rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.8s ease-out;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        input, select {
            background-color: var(--bg-dark);
            color: var(--text-dark);
            border: 1px solid var(--border-dark);
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(192, 0, 0, 0.5);
            transform: scale(1.02);
        }

        input:invalid, select:invalid {
            border-color: var(--danger);
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .btn {
            grid-column: 1 / -1;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.875rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(192, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        #recommendation-card {
            animation: slideUp 0.8s ease-out;
        }

        #recommendation-card h2 {
            margin-top: 0;
        }
        
        #recommendation-content {
            background-color: rgba(192, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
            border-radius: 0.25rem;
            padding: 1.25rem;
            min-height: 120px;
            transition: all 0.5s ease;
            animation: fadeIn 0.8s ease-out;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #recommendation-content p {
            margin: 0;
            color: var(--text-muted);
        }
        
        #recommendation-content .dose {
            font-size: 1.5rem;
            font-weight: 700;
            display: block;
            margin-bottom: 0.5rem;
            animation: popIn 0.5s ease-out;
        }
        
        .dose.success {
            color: var(--success);
        }

        .dose.warning {
            color: var(--warning);
        }

        .dose.danger {
            color: var(--danger);
        }

        .dose.info {
            color: var(--info);
        }

        #recommendation-content .rationale {
            font-style: italic;
            margin-top: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .info-card h2 {
            margin-top: 0;
            color: var(--warning);
            animation: fadeIn 1s ease-out;
        }

        .info-card ul {
            padding-left: 1.25rem;
            margin: 0;
            color: var(--text-muted);
        }
        
        .info-card li {
            margin-bottom: 0.5rem;
            animation: slideIn 0.6s ease-out;
        }
        
        footer {
            font-size: 0.875rem;
            color: var(--text-muted);
            text-align: center;
            max-width: 600px;
            margin: 1rem auto 0;
            animation: fadeIn 1.2s ease-out;
        }

        .copyright {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-dark);
            font-weight: 600;
        }

        .crcl-display {
            background: rgba(34, 197, 94, 0.1);
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            border-left: 3px solid var(--success);
            animation: fadeIn 0.8s ease-out;
        }

        .duration-display {
            background: rgba(96, 165, 250, 0.1);
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            border-left: 3px solid var(--info);
            animation: fadeIn 0.8s ease-out;
        }

        /* New UI Components */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .warning-alert {
            background: rgba(245, 158, 11, 0.15);
            border-left: 4px solid var(--warning);
            padding: 0.75rem;
            margin-top: 1rem;
            border-radius: 0 4px 4px 0;
            animation: fadeIn 0.5s ease-out;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid var(--warning);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-top: 1rem;
            animation: fadeIn 0.5s ease-out;
        }

        /* Evidence base section */
        .evidence-card {
            background-color: var(--card-bg-dark);
            border: 1px solid rgba(96, 165, 250, 0.5);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .evidence-card h2 {
            color: var(--info);
            margin-top: 0;
            border-bottom: 1px solid var(--border-dark);
            padding-bottom: 0.75rem;
        }

        .study-card {
            background: rgba(30, 41, 59, 0.7);
            border-left: 4px solid var(--info);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .study-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .study-title {
            font-weight: 700;
            color: var(--info);
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
        }

        .study-title svg {
            margin-right: 8px;
        }

        .study-details {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 0.5rem;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .study-label {
            color: var(--text-muted);
            font-weight: 500;
        }

        .study-outcome {
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid var(--success);
            padding: 0.5rem;
            border-radius: 0.25rem;
            margin-top: 0.5rem;
        }

        /* Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes popIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            70% {
                transform: scale(1.1);
                opacity: 1;
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes highlight {
            0% {
                background-color: transparent;
            }
            50% {
                background-color: rgba(192, 0, 0, 0.2);
            }
            100% {
                background-color: transparent;
            }
        }

        .highlight {
            animation: highlight 1.5s ease;
        }
        
        .calculation-log {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
            border: 1px solid var(--border-dark);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 4px 0;
            border-bottom: 1px dashed rgba(148, 163, 184, 0.3);
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        
        .instruction-box {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid var(--info);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .lang-toggle-container {
                position: static;
                justify-content: center;
                margin-bottom: 1rem;
            }
            .sticky-logo {
                height: 40px;
                top: 10px;
                left: 10px;
            }
            .container {
                margin-top: 50px;
            }
            .checkbox-group {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Sticky ISIO logo with pulse animation -->
    <div class="sticky-logo">
        <img src="isio.png" alt="ISIO LABORATOIRES">
    </div>

    <div class="container">
        <header>
             <div class="lang-toggle-container">
                <span data-lang-key="lang_en">English</span>
                <label class="lang-toggle">
                    <input type="checkbox" id="language-toggle">
                    <span class="slider"></span>
                </label>
                <span data-lang-key="lang_fr">Francais</span>
            </div>
            <h1 data-lang-key="main_title">Zapixan Dosing Guide</h1>
            <p data-lang-key="subtitle">For Non-Valvular Atrial Fibrillation, Venous Thromboembolism Treatment & Prophylaxis</p>
        </header>

        <main>
            <div class="card" id="patient-info-card">
                <div class="form-grid">
                    <!-- Indication -->
                    <div class="form-group full-width">
                        <label for="indication" data-lang-key="indication_label">Indication for Zapixan</label>
                        <select id="indication">
                            <option value="af" data-lang-key="indication_af">Non-Valvular Atrial Fibrillation</option>
                            <option value="vte_prophylaxis" data-lang-key="indication_vte_prophylaxis">Venous Thromboembolism Prophylaxis (Post-Hip/Knee Replacement)</option>
                            <option value="vte_initial" data-lang-key="indication_vte_initial">Initial Treatment of Deep Vein Thrombosis/Pulmonary Embolism (First 7 Days)</option>
                            <option value="vte_continuation" data-lang-key="indication_vte_continuation">Continuation Treatment of Deep Vein Thrombosis/Pulmonary Embolism (After 7 Days)</option>
                            <option value="vte_prevention" data-lang-key="indication_vte_prevention">Prevention of Recurrent Deep Vein Thrombosis/Pulmonary Embolism (After 6 Months)</option>
                            <option value="thrombus" data-lang-key="indication_thrombus">Intracavitary Thrombus</option>
                        </select>
                    </div>

                    <!-- Patient Data -->
                    <div class="form-group">
                        <label for="age" data-lang-key="age_label">Age (years)</label>
                        <input type="number" id="age" value="78" min="18" max="120">
                    </div>

                    <div class="form-group">
                        <label for="weight" data-lang-key="weight_label">Weight (kg)</label>
                        <input type="number" id="weight" value="55" min="30" max="250">
                    </div>
                    
                    <!-- Gender Selection -->
                    <div class="form-group">
                        <label for="gender" data-lang-key="gender_label">Gender</label>
                        <select id="gender">
                            <option value="male" data-lang-key="gender_male">Male</option>
                            <option value="female" data-lang-key="gender_female">Female</option>
                        </select>
                    </div>

                    <!-- Changed to mg/L -->
                    <div class="form-group">
                        <label for="creatinine" data-lang-key="creatinine_label">Serum Creatinine (mg/L)</label>
                        <input type="number" id="creatinine" value="16" step="0.01" min="1" max="150">
                    </div>
                    
                    <div class="form-group">
                        <label for="hepatic_impairment" data-lang-key="hepatic_label">Hepatic Function (Child-Pugh)</label>
                        <select id="hepatic_impairment">
                            <option value="none" data-lang-key="hepatic_none">None / Mild (Child-Pugh class A)</option>
                            <option value="moderate" data-lang-key="hepatic_moderate">Moderate (Child-Pugh class B)</option>
                            <option value="severe" data-lang-key="hepatic_severe">Severe (Child-Pugh class C)</option>
                        </select>
                    </div>
                    
                    <!-- Dialysis Status Field -->
                    <div class="form-group">
                        <label for="dialysis" data-lang-key="dialysis_label">Dialysis Status</label>
                        <select id="dialysis">
                            <option value="no" data-lang-key="dialysis_no">Not on dialysis</option>
                            <option value="yes" data-lang-key="dialysis_yes">On dialysis</option>
                        </select>
                    </div>
                    
                    <!-- Absolute Contraindications Checkboxes -->
                    <div class="form-group full-width">
                        <label data-lang-key="contra_label">Absolute Contraindications</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="active_bleeding">
                                <label for="active_bleeding" data-lang-key="contra_bleeding">Active bleeding</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="prosthetic_valve">
                                <label for="prosthetic_valve" data-lang-key="contra_valve">Prosthetic heart valve</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="antiphospholipid">
                                <label for="antiphospholipid" data-lang-key="contra_antiphospholipid">Antiphospholipid syndrome</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hypersensitivity">
                                <label for="hypersensitivity" data-lang-key="contra_hypersensitivity">Severe hypersensitivity</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pregnancy">
                                <label for="pregnancy" data-lang-key="contra_pregnancy">Pregnancy</label>
                            </div>
                        </div>
                    </div>
                    
                    <button id="calculate-btn" class="btn" data-lang-key="calculate_btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        <span>Calculate Dose</span>
                    </button>
                </div>
            </div>

            <div class="card" id="recommendation-card">
                <h2 data-lang-key="reco_title">Dosing Recommendation</h2>
                <div id="recommendation-content">
                    <p data-lang-key="reco_initial_prompt">Enter patient details and click "Calculate Dose".</p>
                    <div class="instruction-box">
                        <strong>Instructions:</strong>
                        <ol>
                            <li>Fill in all patient information</li>
                            <li>Select the indication for Zapixan</li>
                            <li>Click "Calculate Dose"</li>
                            <li>Review the dosing recommendation</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="card evidence-card">
                <h2>Evidence Base for Apixaban</h2>
                <!-- Added data-indications attributes to studies -->
                <div class="study-card" data-indications="af">
                    <div class="study-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4M12 8h.01"></path>
                        </svg>
                        ARISTOTLE Trial
                    </div>
                    <div class="study-details">
                        <span class="study-label">Population:</span>
                        <span>18,201 patients with AF and risk factors</span>
                        <span class="study-label">Intervention:</span>
                        <span>Apixaban 5 mg BID vs. Warfarin</span>
                        <span class="study-label">Duration:</span>
                        <span>Median 1.8 years</span>
                    </div>
                    <div class="study-outcome">
                        <strong>Outcomes:</strong> Apixaban superior to warfarin in preventing stroke/systemic embolism (HR 0.79), 
                        caused less major bleeding (HR 0.69), and reduced all-cause mortality (HR 0.89)
                    </div>
                </div>
                
                <div class="study-card" data-indications="vte_initial vte_continuation">
                    <div class="study-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4M12 8h.01"></path>
                        </svg>
                        AMPLIFY Trial
                    </div>
                    <div class="study-details">
                        <span class="study-label">Population:</span>
                        <span>5,395 patients with acute VTE</span>
                        <span class="study-label">Intervention:</span>
                        <span>Apixaban 10 mg BID ×7d then 5 mg BID vs. enoxaparin/warfarin</span>
                        <span class="study-label">Duration:</span>
                        <span>6 months</span>
                    </div>
                    <div class="study-outcome">
                        <strong>Outcomes:</strong> Apixaban non-inferior to conventional therapy in recurrent VTE (2.3% vs 2.7%), 
                        with significantly less major bleeding (0.6% vs 1.8%)
                    </div>
                </div>
                
                <div class="study-card" data-indications="vte_prevention">
                    <div class="study-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4M12 8h.01"></path>
                        </svg>
                        AMPLIFY-EXT Trial
                    </div>
                    <div class="study-details">
                        <span class="study-label">Population:</span>
                        <span>2,482 patients who completed 6-12 months of anticoagulation</span>
                        <span class="study-label">Intervention:</span>
                        <span>Apixaban 2.5 mg BID vs. 5 mg BID vs. placebo</span>
                        <span class="study-label">Duration:</span>
                        <span>12 months</span>
                    </div>
                    <div class="study-outcome">
                        <strong>Outcomes:</strong> Both apixaban doses superior to placebo in preventing recurrent VTE (2.5 mg: 3.8%, 
                        5 mg: 4.2%, placebo: 11.6%), without significant increase in major bleeding
                    </div>
                </div>
                
                <div class="study-card" data-indications="vte_prophylaxis">
                    <div class="study-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4M12 8h.01"></path>
                        </svg>
                        ADOPT Trial
                    </div>
                    <div class="study-details">
                        <span class="study-label">Population:</span>
                        <span>6,528 patients after hip replacement</span>
                        <span class="study-label">Intervention:</span>
                        <span>Apixaban 2.5 mg BID vs. enoxaparin 40 mg daily</span>
                        <span class="study-label">Duration:</span>
                        <span>35 days</span>
                    </div>
                    <div class="study-outcome">
                        <strong>Outcomes:</strong> Similar VTE rates (2.9% vs 3.8%, p=0.09) with apixaban, 
                        but significantly less major bleeding (0.47% vs 1.42%, p<0.001)
                    </div>
                </div>
            </div>

            <div class="card info-card" id="cautions-card">
                <h2 data-lang-key="cautions_title">Contraindications & Cautions</h2>
                <ul>
                    <li data-lang-key="caution_1"><strong>Absolute Contraindications:</strong> Active pathological bleeding, prosthetic heart valves, antiphospholipid syndrome, severe hypersensitivity to apixaban, pregnancy.</li>
                    <li data-lang-key="caution_2"><strong>Drug Interactions:</strong> Avoid use with strong dual CYP3A4 and P-gp inducers. Use with caution and consider dose adjustment with strong dual inhibitors.</li>
                    <li data-lang-key="caution_3"><strong>Renal Impairment:</strong> Not recommended if Creatinine Clearance is less than 15 mL/min (for all indications).</li>
                    <li data-lang-key="caution_4"><strong>Hepatic Impairment:</strong> Not recommended in severe hepatic impairment (Child-Pugh class C). Use with caution in moderate impairment (Child-Pugh class B).</li>
                    <li data-lang-key="caution_5"><strong>Dialysis Considerations:</strong> FDA-approved for AF patients on hemodialysis. Use 5 mg BID, or 2.5 mg BID if meeting ≥2 dose reduction criteria.</li>
                </ul>
            </div>
        </main>
        
        <footer>
            <p data-lang-key="footer_disclaimer_1">This tool is for informational purposes only and is not a substitute for professional medical advice, diagnosis, or treatment. All clinical decisions must be made by a qualified healthcare provider.</p>
            <p class="copyright">Dr El Hajjaj Belghait © 2025</p>
        </footer>
    </div>

    <script>
        // --- TRANSLATION DATA ---
        const translations = {
            en: {
                main_title: "Zapixan Dosing Guide",
                subtitle: "For Non-Valvular Atrial Fibrillation, Venous Thromboembolism Treatment & Prophylaxis",
                indication_label: "Indication for Zapixan",
                indication_af: "Non-Valvular Atrial Fibrillation",
                indication_vte_prophylaxis: "Venous Thromboembolism Prophylaxis (Post-Hip/Knee Replacement)",
                indication_vte_initial: "Initial Treatment of Deep Vein Thrombosis/Pulmonary Embolism (First 7 Days)",
                indication_vte_continuation: "Continuation Treatment of Deep Vein Thrombosis/Pulmonary Embolism (After 7 Days)",
                indication_vte_prevention: "Prevention of Recurrent Deep Vein Thrombosis/Pulmonary Embolism (After 6 Months)",
                indication_thrombus: "Intracavitary Thrombus",
                gender_label: "Gender",
                gender_male: "Male",
                gender_female: "Female",
                age_label: "Age (years)",
                weight_label: "Weight (kg)",
                // Changed to mg/L
                creatinine_label: "Serum Creatinine (mg/L)",
                hepatic_label: "Hepatic Function (Child-Pugh)",
                hepatic_none: "None / Mild (Child-Pugh class A)",
                hepatic_moderate: "Moderate (Child-Pugh class B)",
                hepatic_severe: "Severe (Child-Pugh class C)",
                calculate_btn: "Calculate Dose",
                reco_title: "Dosing Recommendation",
                reco_initial_prompt: "Enter patient details and click \"Calculate Dose\".",
                cautions_title: "Contraindications & Cautions",
                caution_1: "<strong>Absolute Contraindications:</strong> Active pathological bleeding, prosthetic heart valves, antiphospholipid syndrome, severe hypersensitivity to apixaban, pregnancy.",
                caution_2: "<strong>Drug Interactions:</strong> Avoid use with strong dual CYP3A4 and P-gp inducers. Use with caution and consider dose adjustment with strong dual inhibitors.",
                caution_3: "<strong>Renal Impairment:</strong> Not recommended if Creatinine Clearance is less than 15 mL/min (for all indications).",
                caution_4: "<strong>Hepatic Impairment:</strong> Not recommended in severe hepatic impairment (Child-Pugh class C). Use with caution in moderate impairment (Child-Pugh class B).",
                caution_5: "<strong>Dialysis Considerations:</strong> FDA-approved for AF patients on hemodialysis. Use 5 mg BID, or 2.5 mg BID if meeting ≥2 dose reduction criteria.",
                footer_disclaimer_1: "This tool is for informational purposes only and is not a substitute for professional medical advice, diagnosis, or treatment. All clinical decisions must be made by a qualified healthcare provider.",
                lang_en: "English",
                lang_fr: "Français",
                dialysis_label: "Dialysis Status",
                dialysis_no: "Not on dialysis",
                dialysis_yes: "On dialysis",
                contra_label: "Absolute Contraindications",
                contra_bleeding: "Active bleeding",
                contra_valve: "Prosthetic heart valve",
                contra_antiphospholipid: "Antiphospholipid syndrome",
                contra_hypersensitivity: "Severe hypersensitivity",
                contra_pregnancy: "Pregnancy",
                // Dynamic strings
                reco_dose_prefix: "Recommended Zapixan Dose",
                error_invalid_input: "Please enter valid positive numbers for age, weight, and creatinine.",
                reco_not_recommended: "Not Recommended",
                reco_hepatic_severe: "Zapixan is not recommended in patients with severe hepatic impairment (Child-Pugh class C).",
                reco_crcl_low: (crcl, threshold) => `Creatinine clearance is below the recommended threshold for this indication (Creatinine Clearance approx. ${crcl} mL/min < ${threshold} mL/min).`,
                reco_reduction_met: (count, criteria) => `Dose reduction to 2.5 mg twice daily is indicated because the patient meets ${count} of 3 criteria: ${criteria.join(', ')}.`,
                reco_standard_dose: (crcl) => `Standard dose. The patient does not meet criteria for dose reduction.`,
                reco_vte_prophylaxis: "This is the standard prophylactic dose following orthopedic surgery.",
                reco_vte_initial: "This is the standard initial treatment regimen for the first 7 days of acute Deep Vein Thrombosis/Pulmonary Embolism treatment.",
                reco_vte_continuation: "This is the standard continuation dose after the initial 7 days of treatment for Deep Vein Thrombosis/Pulmonary Embolism.",
                reco_vte_prevention: "This is the standard dose for extended prophylaxis to prevent recurrent Deep Vein Thrombosis/Pulmonary Embolism after at least 6 months of initial treatment.",
                reco_thrombus: "This dosing is based on expert opinion for intracavitary thrombus.",
                reco_hepatic_moderate_note: " Use with caution in moderate hepatic impairment (Child-Pugh class B).",
                reco_crcl_display: (crcl) => `Calculated Creatinine Clearance: <strong>${crcl} mL/min</strong>`,
                reco_duration: (duration) => `Recommended Duration: <strong>${duration}</strong>`,
                reco_renal_adjustment: " (Renal dose adjustment)",
                warning_age: "⚠️ Extreme age: Increased bleeding risk",
                warning_weight_low: "⚠️ Low body weight: Monitor closely",
                warning_weight_high: "⚠️ High body weight: Consider anti-Xa monitoring",
                warning_crcl: (min, max) => `⚠️ Renal impairment: Monitor renal function monthly (CrCl ${min}-${max} mL/min)`,
                warning_dialysis: "⚠️ Limited data in dialysis: Monitor closely for efficacy and bleeding",
                contra_absolute: "Zapixan is contraindicated due to: ",
                reco_dialysis_dose: "FDA-approved dosing for hemodialysis patients"
            },
            fr: {
                main_title: "Guide de Dosage Zapixan",
                subtitle: "Pour la Fibrillation Auriculaire Non Valvulaire, le Traitement et la Prophylaxie de la Thromboembolie Veineuse",
                indication_label: "Indication pour Zapixan",
                indication_af: "Fibrillation Auriculaire Non Valvulaire",
                indication_vte_prophylaxis: "Prophylaxie de la Thromboembolie Veineuse (Après Prothèse de Hanche/Genou)",
                indication_vte_initial: "Traitement Initial de la Thrombose Veineuse Profonde/Embolie Pulmonaire (7 premiers jours)",
                indication_vte_continuation: "Poursuite du Traitement de la Thrombose Veineuse Profonde/Embolie Pulmonaire (Après 7 jours)",
                indication_vte_prevention: "Prévention de la Récidive de Thrombose Veineuse Profonde/Embolie Pulmonaire (Après 6 mois)",
                indication_thrombus: "Thrombus intracavitaire",
                gender_label: "Genre",
                gender_male: "Homme",
                gender_female: "Femme",
                age_label: "Âge (années)",
                weight_label: "Poids (kg)",
                // Changed to mg/L
                creatinine_label: "Créatinine Sérique (mg/L)",
                hepatic_label: "Fonction Hépatique (Child-Pugh)",
                hepatic_none: "Aucune / Légère (Classe Child-Pugh A)",
                hepatic_moderate: "Modérée (Classe Child-Pugh B)",
                hepatic_severe: "Sévère (Classe Child-Pugh C)",
                calculate_btn: "Calculer la Dose",
                reco_title: "Recommandation de Dosage",
                reco_initial_prompt: "Entrez les détails du patient et cliquez sur \"Calculer la Dose\".",
                cautions_title: "Contre-indications & Précautions",
                caution_1: "<strong>Contre-indications absolues :</strong> Saignement pathologique actif, valves cardiaques prothétiques, syndrome des antiphospholipides, hypersensibilité sévère à l'apixaban, grossesse.",
                caution_2: "<strong>Interactions médicamenteuses :</strong> Éviter l'utilisation avec des inducteurs doubles puissants du CYP3A4 et de la P-gp. Utiliser avec prudence et envisager un ajustement de la dose avec des inhibiteurs doubles puissants.",
                caution_3: "<strong>Insuffisance rénale :</strong> Non recommandé si la clairance de la créatinine est inférieure à 15 mL/min (pour toutes les indications).",
                caution_4: "<strong>Insuffisance hépatique :</strong> Non recommandé en cas d'insuffisance hépatique sévère (Classe Child-Pugh C). Utiliser avec prudence en cas d'insuffisance modérée (Classe Child-Pugh B).",
                caution_5: "<strong>Considérations pour la dialyse :</strong> Approuvé par la FDA pour les patients FA sous hémodialyse. Utiliser 5 mg deux fois par jour, ou 2,5 mg deux fois par jour si ≥2 critères de réduction de dose sont remplis.",
                footer_disclaimer_1: "Cet outil est fourni à titre informatif uniquement et ne remplace pas un avis médical professionnel, un diagnostic ou un traitement. Toutes les décisions cliniques doivent être prises par un professionnel de la santé qualifié.",
                lang_en: "English",
                lang_fr: "Français",
                dialysis_label: "État de dialyse",
                dialysis_no: "Pas sous dialyse",
                dialysis_yes: "Sous dialyse",
                contra_label: "Contre-indications absolues",
                contra_bleeding: "Saignement actif",
                contra_valve: "Valve cardiaque prothétique",
                contra_antiphospholipid: "Syndrome des antiphospholipides",
                contra_hypersensitivity: "Hypersensibilité sévère",
                contra_pregnancy: "Grossesse",
                // Dynamic strings
                reco_dose_prefix: "Dose de Zapixan Recommandée",
                error_invalid_input: "Veuillez entrer des nombres positifs valides pour l'âge, le poids et la créatinine.",
                reco_not_recommended: "Non Recommandé",
                reco_hepatic_severe: "Zapixan n'est pas recommandé chez les patients présentant une insuffisance hépatique sévère (Classe Child-Pugh C).",
                reco_crcl_low: (crcl, threshold) => `La clairance de la créatinine est inférieure au seuil recommandé pour cette indication (Clairance de la créatinine approx. ${crcl} mL/min < ${threshold} mL/min).`,
                reco_reduction_met: (count, criteria) => `Une réduction de la dose à 2.5 mg deux fois par jour est indiquée car le patient remplit ${count} des 3 critères : ${criteria.join(', ')}.`,
                reco_standard_dose: (crcl) => `Dose standard. Le patient ne remplit pas les critères de réduction de dose.`,
                reco_vte_prophylaxis: "C'est la dose prophylactique standard après une chirurgie orthopédique.",
                reco_vte_initial: "C'est le schéma thérapeutique initial standard pour les 7 premiers jours de traitement d'une Thrombose Veineuse Profonde/Embolie Pulmonaire aiguë.",
                reco_vte_continuation: "C'est la dose de continuation standard après les 7 premiers jours de traitement pour une Thrombose Veineuse Profonde/Embolie Pulmonaire.",
                reco_vte_prevention: "C'est la dose standard pour la prophylaxie prolongée afin de prévenir la récidive de Thrombose Veineuse Profonde/Embolie Pulmonaire après au moins 6 mois de traitement initial.",
                reco_thrombus: "Ce dosage est basé sur l'avis d'experts pour le thrombus intracavitaire.",
                reco_hepatic_moderate_note: " Utiliser avec prudence en cas d'insuffisance hépatique modérée (Classe Child-Pugh B).",
                reco_crcl_display: (crcl) => `Clairance de la créatinine calculée : <strong>${crcl} mL/min</strong>`,
                reco_duration: (duration) => `Durée recommandée : <strong>${duration}</strong>`,
                reco_renal_adjustment: " (Ajustement de la dose en cas d'insuffisance rénale)",
                warning_age: "⚠️ Âge extrême : Risque accru de saignement",
                warning_weight_low: "⚠️ Poids corporel faible : Surveiller de près",
                warning_weight_high: "⚠️ Poids corporel élevé : Envisager un monitoring anti-Xa",
                warning_crcl: (min, max) => `⚠️ Insuffisance rénale : Surveiller la fonction rénale mensuellement (ClCr ${min}-${max} mL/min)`,
                warning_dialysis: "⚠️ Données limitées en dialyse : Surveiller étroitement l'efficacité et les saignements",
                contra_absolute: "Zapixan est contre-indiqué en raison de : ",
                reco_dialysis_dose: "Dosage approuvé par la FDA pour les patients sous hémodialyse"
            }
        };

        // --- RENAL THRESHOLDS ---
        const renalThresholds = {
            af: 15,
            vte_prophylaxis: 15,
            vte_initial: 15,
            vte_continuation: 15,
            vte_prevention: 15,
            thrombus: 15
        };

        // --- LANGUAGE SWITCHER LOGIC ---
        let currentLanguage = 'en';
        const langToggle = document.getElementById('language-toggle');

        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang][key]) {
                    element.innerHTML = translations[lang][key];
                }
            });
            // Recalculate to update the recommendation text
            calculateApixabanDose();
        }

        langToggle.addEventListener('change', () => {
            if (langToggle.checked) {
                setLanguage('fr');
            } else {
                setLanguage('en');
            }
        });

        // Auto-detect browser language
        const userLang = navigator.language.startsWith('fr') ? 'fr' : 'en';
        setLanguage(userLang);
        if (userLang === 'fr') {
            langToggle.checked = true;
        }

        // --- STUDY FILTERING FUNCTION ---
        function filterStudiesByIndication(indication) {
            const allStudies = document.querySelectorAll('.study-card');
            
            allStudies.forEach(study => {
                const indications = study.getAttribute('data-indications').split(' ');
                if (indications.includes(indication)) {
                    study.style.display = 'block';
                } else {
                    study.style.display = 'none';
                }
            });
        }

        // --- CALCULATION LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const calculateBtn = document.getElementById('calculate-btn');
            const allInputs = document.querySelectorAll('#patient-info-card input, #patient-info-card select');
            const indicationSelect = document.getElementById('indication');

            calculateBtn.addEventListener('click', calculateApixabanDose);
            allInputs.forEach(input => {
                input.addEventListener('change', calculateApixabanDose);
            });
            
            // Filter studies when indication changes
            indicationSelect.addEventListener('change', () => {
                filterStudiesByIndication(indicationSelect.value);
            });
            
            // Initial calculation and study filtering
            calculateApixabanDose();
            filterStudiesByIndication(indicationSelect.value);
        });

        function calculateApixabanDose() {
            const langDict = translations[currentLanguage];
            const recoDiv = document.getElementById('recommendation-content');

            // Show loading indicator
            recoDiv.innerHTML = `
                <div class="loading-container">
                    <div class="loading"></div>
                    <p>Calculating dose recommendation...</p>
                </div>
            `;

            // Give the UI time to update before heavy calculation
            setTimeout(() => {
                try {
                    // 1. Get all input values
                    const indication = document.getElementById('indication').value;
                    const age = parseInt(document.getElementById('age').value);
                    const weight = parseInt(document.getElementById('weight').value);
                    const gender = document.getElementById('gender').value;
                    const creatinineMgL = parseFloat(document.getElementById('creatinine').value);
                    const hepaticImpairment = document.getElementById('hepatic_impairment').value;
                    const dialysis = document.getElementById('dialysis').value;
                    const activeBleeding = document.getElementById('active_bleeding').checked;
                    const prostheticValve = document.getElementById('prosthetic_valve').checked;
                    const antiphospholipid = document.getElementById('antiphospholipid').checked;
                    const hypersensitivity = document.getElementById('hypersensitivity').checked;
                    const pregnancy = document.getElementById('pregnancy').checked;

                    // Apply highlight animation to the card
                    document.getElementById('recommendation-card').classList.add('highlight');
                    setTimeout(() => {
                        document.getElementById('recommendation-card').classList.remove('highlight');
                    }, 1500);

                    // 2. Validate inputs
                    if (isNaN(age) || isNaN(weight) || isNaN(creatinineMgL) || age <= 0 || weight <= 0 || creatinineMgL <= 0) {
                        recoDiv.innerHTML = `<p style="color: var(--danger);">${langDict.error_invalid_input}</p>`;
                        recoDiv.classList.add('shake');
                        setTimeout(() => recoDiv.classList.remove('shake'), 500);
                        return;
                    }

                    // Convert creatinine from mg/L to mg/dL (divide by 10)
                    const creatinine = creatinineMgL / 10.0;

                    // 3. Calculate CrCl with validation and gender adjustment
                    if (age > 140 || creatinine <= 0) {
                        recoDiv.innerHTML = `<p style="color: var(--danger);">${langDict.error_invalid_input}</p>`;
                        return;
                    }
                    
                    let crcl = Math.max(0, (140 - age) * weight) / (72 * creatinine);
                    if (gender === 'female') crcl *= 0.85; // Gender adjustment for females
                    crcl = Math.round(crcl * 10) / 10; // Round to 1 decimal

                    // 4. Check for absolute contraindications
                    const contraindications = [];
                    if (activeBleeding) contraindications.push(langDict.contra_bleeding);
                    if (prostheticValve) contraindications.push(langDict.contra_valve);
                    if (antiphospholipid) contraindications.push(langDict.contra_antiphospholipid);
                    if (hypersensitivity) contraindications.push(langDict.contra_hypersensitivity);
                    if (pregnancy) contraindications.push(langDict.contra_pregnancy);
                    
                    if (contraindications.length > 0) {
                        recoDiv.innerHTML = `
                            <strong class="dose danger">${langDict.reco_not_recommended}</strong>
                            <p class="rationale">${langDict.contra_absolute} ${contraindications.join(', ')}</p>
                        `;
                        return;
                    }

                    if (hepaticImpairment === 'severe') {
                        recoDiv.innerHTML = `
                            <strong class="dose danger">${langDict.reco_not_recommended}</strong>
                            <p class="rationale">${langDict.reco_hepatic_severe}</p>
                        `;
                        return;
                    }

                    const renalThreshold = renalThresholds[indication] || 15;
                    if (dialysis === 'no' && crcl < renalThreshold) {
                        recoDiv.innerHTML = `
                            <strong class="dose danger">${langDict.reco_not_recommended}</strong>
                            <p class="rationale">${langDict.reco_crcl_low(crcl, renalThreshold)}</p>
                        `;
                        return;
                    }

                    // 5. Perform calculation
                    let dose = '';
                    let rationale = '';
                    let doseClass = 'success';
                    let duration = '';
                    let warnings = [];

                    // Add CrCl display
                    let crclDisplay = `<div class="crcl-display">${langDict.reco_crcl_display(crcl)}</div>`;

                    // Check for extreme values
                    if (age > 90) warnings.push(langDict.warning_age);
                    if (weight < 40) warnings.push(langDict.warning_weight_low);
                    if (weight > 120) warnings.push(langDict.warning_weight_high);
                    if (crcl > 15 && crcl < 30) warnings.push(langDict.warning_crcl(15, 30));
                    if (dialysis === 'yes') warnings.push(langDict.warning_dialysis);

                    // Calculate reduction criteria for all AF patients
                    let reductionCriteriaCount = 0;
                    let criteriaMet = []; // English criteria
                    let criteriaMetFR = []; // French criteria

                    if (age >= 80) {
                        reductionCriteriaCount++;
                        criteriaMet.push("Age ≥ 80 years");
                        criteriaMetFR.push("Âge ≥ 80 ans");
                    }
                    if (weight <= 60) {
                        reductionCriteriaCount++;
                        criteriaMet.push("Weight ≤ 60 kg");
                        criteriaMetFR.push("Poids ≤ 60 kg");
                    }
                    // Note: creatinine variable here is in mg/dL (we converted the input from mg/L to mg/dL)
                    if (creatinine >= 1.5) {
                        reductionCriteriaCount++;
                        criteriaMet.push("Serum Creatinine ≥ 1.5 mg/dL");
                        criteriaMetFR.push("Créatinine Sérique ≥ 1.5 mg/dL");
                    }

                    // Dialysis-specific logic
                    if (dialysis === 'yes') {
                        if (indication === 'af') {
                            // FDA-approved for dialysis patients with AF
                            if (reductionCriteriaCount >= 2) {
                                dose = '2.5 mg twice daily';
                                const criteriaList = currentLanguage === 'fr' ? criteriaMetFR : criteriaMet;
                                rationale = `${langDict.reco_reduction_met(reductionCriteriaCount, criteriaList)} ${langDict.reco_dialysis_dose}`;
                                doseClass = 'info';
                            } else {
                                dose = '5 mg twice daily';
                                rationale = `${langDict.reco_standard_dose(crcl)} ${langDict.reco_dialysis_dose}`;
                                doseClass = 'info';
                            }
                            duration = "Long-term therapy, reassess annually";
                        } else {
                            recoDiv.innerHTML = `
                                <strong class="dose danger">${langDict.reco_not_recommended}</strong>
                                <p class="rationale">Zapixan is not recommended for this indication in dialysis patients due to limited data</p>
                            `;
                            return;
                        }
                    } 
                    // Non-dialysis patients
                    else if (indication === 'af') {
                        let standardDose = '5 mg twice daily';
                        let reducedDose = '2.5 mg twice daily';
                        let finalDose = standardDose;

                        if (reductionCriteriaCount >= 2) {
                            finalDose = reducedDose;
                            const criteriaList = currentLanguage === 'fr' ? criteriaMetFR : criteriaMet;
                            rationale = langDict.reco_reduction_met(reductionCriteriaCount, criteriaList);
                            doseClass = 'warning';
                        } else {
                            finalDose = standardDose;
                            rationale = langDict.reco_standard_dose(crcl);
                        }
                        dose = finalDose;
                        duration = "Long-term therapy, reassess annually";
                    } else if (indication === 'vte_prophylaxis') {
                        dose = '2.5 mg twice daily';
                        rationale = langDict.reco_vte_prophylaxis;
                        doseClass = 'warning';
                        duration = "32-38 days for hip replacement, 10-14 days for knee replacement";
                    } else if (indication === 'vte_initial') {
                        dose = '10 mg twice daily for 7 days, then 5 mg twice daily';
                        rationale = langDict.reco_vte_initial;
                        doseClass = 'info';
                        duration = "7 days (then switch to continuation dose)";
                    } else if (indication === 'vte_continuation') {
                        // CORRECTED: Continuation dose is always 5 mg BID regardless of renal function
                        dose = '5 mg twice daily';
                        rationale = langDict.reco_vte_continuation;
                        doseClass = 'info';
                        duration = "At least 3 months, consider extended therapy based on risk";
                    } else if (indication === 'vte_prevention') {
                        // CORRECTED: Prevention dose is always 2.5 mg BID regardless of renal function
                        dose = '2.5 mg twice daily';
                        rationale = langDict.reco_vte_prevention;
                        doseClass = 'warning';
                        duration = "Indefinite for high-risk patients, reassess annually";
                    } else if (indication === 'thrombus') {
                        dose = '5 mg twice daily';
                        rationale = langDict.reco_thrombus;
                        doseClass = 'warning';
                        duration = "Until thrombus resolution as confirmed by imaging";
                    }

                    // Add hepatic impairment note
                    if (hepaticImpairment === 'moderate') {
                        rationale += langDict.reco_hepatic_moderate_note;
                    }

                    // Add duration display
                    let durationDisplay = duration ? `<div class="duration-display">${langDict.reco_duration(duration)}</div>` : '';

                    // Add warnings if any
                    let warningDisplay = '';
                    if (warnings.length > 0) {
                        warningDisplay = `<div class="warning-box">${warnings.join('<br>')}</div>`;
                    }

                    // 6. Display results with animations
                    recoDiv.innerHTML = `
                        <strong class="dose ${doseClass}">${langDict.reco_dose_prefix}: ${dose}</strong>
                        ${crclDisplay}
                        ${durationDisplay}
                        <p class="rationale">${rationale}</p>
                        ${warningDisplay}
                    `;
                } catch (error) {
                    recoDiv.innerHTML = `
                        <p style="color: var(--danger);">
                            An error occurred: ${error.message}
                        </p>
                        <p>Please check your inputs and try again</p>
                    `;
                }
            }, 300); // Short delay to show loading indicator
        }
<!-- Install Button Container -->
<div id="install-container" style="position: fixed; bottom: 20px; right: 20px; display: none; z-index: 1000;">
  <button id="install-button" style="
    padding: 12px 20px;
    background: #c00000;
    color: white;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
  ">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
      <polyline points="7 10 12 15 17 10"></polyline>
      <line x1="12" y1="15" x2="12" y2="3"></line>
    </svg>
    Install App
  </button>
</div>

<script>
// Robust install handler with debug logging
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  console.log('Before install prompt triggered');
  
  // Store event for later use
  window.deferredPrompt = e;
  
  // Show install button
  const installContainer = document.getElementById('install-container');
  if (installContainer) {
    installContainer.style.display = 'block';
    
    // Add click handler
    const installButton = document.getElementById('install-button');
    if (installButton) {
      installButton.onclick = async () => {
        if (!window.deferredPrompt) return;
        window.deferredPrompt.prompt();
        const { outcome } = await window.deferredPrompt.userChoice;
        console.log('User response to install prompt:', outcome);
        installContainer.style.display = 'none';
        window.deferredPrompt = null;
      };
    }
  }
});

// Hide install button after successful installation
window.addEventListener('appinstalled', () => {
  console.log('PWA was installed');
  const installContainer = document.getElementById('install-container');
  if (installContainer) installContainer.style.display = 'none';
});

// Log installability status
window.addEventListener('load', () => {
  if ('getInstalledRelatedApps' in navigator) {
    navigator.getInstalledRelatedApps().then(apps => {
      console.log('Installed related apps:', apps);
      console.log('Installable status:', apps.length === 0);
    });
  }
});
</script>

<!-- Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js', { scope: './' })
      .then(registration => {
        console.log('Service Worker registered with scope:', registration.scope);
        
        // Force service worker update on page load
        registration.update();
        
        // Check for controller
        if (navigator.serviceWorker.controller) {
          console.log('Service Worker is controlling the page');
        } else {
          console.log('Service Worker not controlling the page');
        }
      })
      .catch(error => {
        console.error('Service Worker registration failed:', error);
      });
  });
}
</script>


</body>
</html>
